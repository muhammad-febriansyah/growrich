 Plan to implement                                                                                                                                                                                        │
│                                                                                                                                                                                                          │
│ Plan: Migrate PackageType Enum → DB-Backed Model + Admin CRUD                                                                                                                                            │
│                                                                                                                                                                                                          │
│ Context                                                                                                                                                                                                  │
│                                                                                                                                                                                                          │
│ PackageType (Silver, Gold, Platinum) saat ini hardcoded sebagai PHP enum. Semua nilai bisnis (harga, PP, RP, bonus) tidak bisa diubah tanpa deploy ulang. Task ini memindahkan semua konfigurasi paket   │
│ ke database dan menambahkan CRUD di admin.                                                                                                                                                               │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Scope Dampak                                                                                                                                                                                             │
│                                                                                                                                                                                                          │
│ - 22 PHP files referensi PackageType enum                                                                                                                                                                │
│ - 2 DB columns menyimpan package_type sebagai string (member_profiles, registration_pins) — tidak perlu diubah                                                                                           │
│ - 10 enum methods → pindah ke Package model                                                                                                                                                              │
│ - Strategi: Enum tetap ada sebagai "thin delegate" — method-nya diarahkan ke Package model via cache, sehingga semua business logic yang sudah ada (controllers, services) tidak perlu diubah            │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Step 1 — Migration & Model                                                                                                                                                                               │
│                                                                                                                                                                                                          │
│ database/migrations/..._create_packages_table.php                                                                                                                                                        │
│                                                                                                                                                                                                          │
│ Schema::create('packages', function (Blueprint $table) {                                                                                                                                                 │
│     $table->id();                                                                                                                                                                                        │
│     $table->string('key')->unique();           // 'Silver', 'Gold', 'Platinum'                                                                                                                           │
│     $table->string('name');                                                                                                                                                                              │
│     $table->unsignedSmallInteger('sort_order');                                                                                                                                                          │
│     $table->unsignedSmallInteger('pairing_point');                                                                                                                                                       │
│     $table->unsignedSmallInteger('reward_point');                                                                                                                                                        │
│     $table->unsignedSmallInteger('max_pairing_per_day');                                                                                                                                                 │
│     $table->unsignedBigInteger('registration_price');                                                                                                                                                    │
│     $table->unsignedBigInteger('upgrade_price')->nullable();                                                                                                                                             │
│     $table->unsignedInteger('sponsor_bonus_unit');   // 200_000                                                                                                                                          │
│     $table->unsignedInteger('leveling_bonus_amount'); // 250k/500k/750k                                                                                                                                  │
│     $table->timestamps();                                                                                                                                                                                │
│ });                                                                                                                                                                                                      │
│                                                                                                                                                                                                          │
│ app/Models/Package.php                                                                                                                                                                                   │
│                                                                                                                                                                                                          │
│ - Methods: sponsorBonusFor(Package), next(), pairingPoint(), maxPairingPerDay(), registrationPrice(), upgradePrice(), label()                                                                            │
│ - Static: findByKey(string $key) — dengan Cache::remember('package_'.$key, 600, fn => ...)                                                                                                               │
│ - Const: PAIRING_BONUS_AMOUNT = 100_000                                                                                                                                                                  │
│ - Scope: scopeOrdered() — orderBy sort_order                                                                                                                                                             │
│ - Relationship: membersProfiles(): HasMany, registrationPins(): HasMany                                                                                                                                  │
│                                                                                                                                                                                                          │
│ database/seeders/PackageSeeder.php                                                                                                                                                                       │
│                                                                                                                                                                                                          │
│ Seed Silver/Gold/Platinum dengan nilai saat ini dari enum.                                                                                                                                               │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Step 2 — Update PackageType Enum (thin delegate)                                                                                                                                                         │
│                                                                                                                                                                                                          │
│ app/Enums/Mlm/PackageType.php — semua method body diganti untuk delegate ke Package::findByKey($this->value):                                                                                            │
│                                                                                                                                                                                                          │
│ public function pairingPoint(): int       { return Package::findByKey($this->value)->pairing_point; }                                                                                                    │
│ public function rewardPoint(): int        { return Package::findByKey($this->value)->reward_point; }                                                                                                     │
│ public function maxPairingPerDay(): int   { return Package::findByKey($this->value)->max_pairing_per_day; }                                                                                              │
│ public function registrationPrice(): int  { return Package::findByKey($this->value)->registration_price; }                                                                                               │
│ public function upgradePrice(): ?int      { return Package::findByKey($this->value)->upgrade_price; }                                                                                                    │
│ public function sponsorBonusFor(PackageType $other): int {                                                                                                                                               │
│     return Package::findByKey($this->value)->sponsorBonusFor(Package::findByKey($other->value));                                                                                                         │
│ }                                                                                                                                                                                                        │
│ public function next(): ?PackageType {                                                                                                                                                                   │
│     $next = Package::findByKey($this->value)->next();                                                                                                                                                    │
│     return $next ? PackageType::from($next->key) : null;                                                                                                                                                 │
│ }                                                                                                                                                                                                        │
│ public static function pairingBonusAmount(): int { return Package::PAIRING_BONUS_AMOUNT; }                                                                                                               │
│                                                                                                                                                                                                          │
│ Semua controller/service/test yang ada tidak perlu diubah.                                                                                                                                               │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Step 3 — Admin Controller & Route                                                                                                                                                                        │
│                                                                                                                                                                                                          │
│ app/Http/Controllers/Admin/PackageController.php                                                                                                                                                         │
│                                                                                                                                                                                                          │
│ - index() — list semua packages, ordered by sort_order                                                                                                                                                   │
│ - create() — render form create                                                                                                                                                                          │
│ - store() — validasi + simpan + Cache::flush() atau forget key                                                                                                                                           │
│ - edit(Package) — render form edit dengan data existing                                                                                                                                                  │
│ - update(Package) — validasi + update + clear cache                                                                                                                                                      │
│ - destroy(Package) — cek apakah ada member/pin yang pakai, tolak jika ada                                                                                                                                │
│                                                                                                                                                                                                          │
│ Validasi fields: name, sort_order (unique), pairing_point, reward_point, max_pairing_per_day, registration_price, upgrade_price (nullable), sponsor_bonus_unit, leveling_bonus_amount.                   │
│                                                                                                                                                                                                          │
│ routes/web.php — tambahkan:                                                                                                                                                                              │
│                                                                                                                                                                                                          │
│ Route::resource('admin/packages', App\Http\Controllers\Admin\PackageController::class)                                                                                                                   │
│     ->names('admin.packages');                                                                                                                                                                           │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Step 4 — Frontend Pages                                                                                                                                                                                  │
│                                                                                                                                                                                                          │
│ resources/js/pages/admin/packages/index.tsx                                                                                                                                                              │
│                                                                                                                                                                                                          │
│ - Tabel dengan kolom: Nama, Sort Order, Harga Daftar, Harga Upgrade, PP, Max Pair/Hari, Leveling Bonus                                                                                                   │
│ - Edit button per row, Delete button (disabled jika ada member)                                                                                                                                          │
│ - Tombol "Tambah Paket" untuk create                                                                                                                                                                     │
│                                                                                                                                                                                                          │
│ resources/js/pages/admin/packages/create.tsx                                                                                                                                                             │
│                                                                                                                                                                                                          │
│ Form dengan semua field, menggunakan pola dari products/create.tsx.                                                                                                                                      │
│                                                                                                                                                                                                          │
│ resources/js/pages/admin/packages/edit.tsx                                                                                                                                                               │
│                                                                                                                                                                                                          │
│ Form pre-populated dari package prop.                                                                                                                                                                    │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Step 5 — Sidebar                                                                                                                                                                                         │
│                                                                                                                                                                                                          │
│ Tambahkan menu "Paket" di sidebar admin (resources/js/components/app-sidebar.tsx).                                                                                                                       │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Step 6 — Seeder Registration                                                                                                                                                                             │
│                                                                                                                                                                                                          │
│ Tambahkan PackageSeeder ke DatabaseSeeder sebelum MlmNetworkSeeder.                                                                                                                                      │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Step 7 — Pint + Tests                                                                                                                                                                                    │
│                                                                                                                                                                                                          │
│ Jalankan vendor/bin/pint --dirty setelah semua perubahan.                                                                                                                                                │
│                                                                                                                                                                                                          │
│ Buat tests/Feature/Admin/PackageControllerTest.php:                                                                                                                                                      │
│ - Admin bisa list packages                                                                                                                                                                               │
│ - Admin bisa create package baru                                                                                                                                                                         │
│ - Admin bisa update package (verifikasi cache di-clear)                                                                                                                                                  │
│ - Admin tidak bisa delete package yang dipakai member                                                                                                                                                    │
│ - Admin bisa delete package yang belum dipakai                                                                                                                                                           │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ File yang Dimodifikasi / Dibuat                                                                                                                                                                          │
│                                                                                                                                                                                                          │
│ ┌───────────────────────────────────────────────────┬────────────────────────────────────┐                                                                                                               │
│ │                       File                        │               Action               │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ database/migrations/..._create_packages_table.php │ CREATE                             │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ app/Models/Package.php                            │ CREATE                             │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ database/seeders/PackageSeeder.php                │ CREATE                             │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ database/seeders/DatabaseSeeder.php               │ MODIFY (add PackageSeeder)         │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ app/Enums/Mlm/PackageType.php                     │ MODIFY (delegate to Package model) │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ app/Http/Controllers/Admin/PackageController.php  │ CREATE                             │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ routes/web.php                                    │ MODIFY (add resource route)        │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ resources/js/pages/admin/packages/index.tsx       │ CREATE                             │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ resources/js/pages/admin/packages/create.tsx      │ CREATE                             │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ resources/js/pages/admin/packages/edit.tsx        │ CREATE                             │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ resources/js/components/app-sidebar.tsx           │ MODIFY (add menu item)             │                                                                                                               │
│ ├───────────────────────────────────────────────────┼────────────────────────────────────┤                                                                                                               │
│ │ tests/Feature/Admin/PackageControllerTest.php     │ CREATE                             │                                                                                                               │
│ └───────────────────────────────────────────────────┴────────────────────────────────────┘                                                                                                               │
│                                                                                                                                                                                                          │
│ Tidak dimodifikasi: BonusRunnerService, RegistrationController, UpgradeController, PinController, semua factories, semua existing tests — semuanya tetap berjalan karena enum delegate ke Package model. │
│                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                      │
│ Verifikasi                                                                                                                                                                                               │
│                                                                                                                                                                                                          │
│ 1. php artisan migrate — tabel packages terbuat                                                                                                                                                          │
│ 2. php artisan db:seed --class=PackageSeeder — 3 package terisi                                                                                                                                          │
│ 3. Buka /admin/packages — CRUD berfungsi                                                                                                                                                                 │
│ 4. Update salah satu nilai (mis. registration_price Silver)                                                                                                                                              │
│ 5. Cek PackageType::Silver->registrationPrice() via tinker mengembalikan nilai baru                                                                                                                      │
│ 6. php artisan test --compact tests/Feature/Admin/PackageControllerTest.php   